<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Local Storage API</title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
    <script src="../versions/ls-v.1.1.0.js"></script>

    <style>
        form {
            margin-top: 30px;
        }
        .primary-menu {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

<div class="container">
    <nav class="primary-menu">
        <div class="nav-wrapper">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="page.html">Page</a></li>
            </ul>
        </div>
    </nav>

    <a class="btn" id="set">Set</a>
    <a class="btn" id="remove">Remove</a>

    <form>
        <h6>
            Fill out the form fields below and click the update button to update storage
            and instance data
        </h6>

        <label>Title</label>
        <input type="text" id="title" />

        <label>Content</label>
        <textarea class="materialize-textarea" id="content"></textarea>

        <a class="btn" id="update">Update</a>
    </form>

    <div class="content">
        <h3 id="title-html"></h3>
        <p id="content-html"></p>
    </div>
</div>

<script>
    var pagesCollection = {
        title: 'Home',
        content: 'This is the home page'
    },
    pagesLS = new LS({
        endpoint: '/api/pages'
    });

    pagesLS.get(function (data) {
        if (data.error) {
            document.getElementById('content-html').innerHTML = data.error.message;
        } else {
            document.getElementById('title-html').innerHTML = data.title;
            document.getElementById('content-html').innerHTML = data.content;

            document.getElementById('title').value = data.title;
            document.getElementById('content').value = data.content;
        }
    });

    document.getElementById('set').addEventListener('click', function () {
        pagesLS.set(pagesCollection, function (data) {
            document.getElementById('title').value = data.title;
            document.getElementById('content').value = data.content;
            document.getElementById('title-html').innerHTML = data.title;
            document.getElementById('content-html').innerHTML = data.content;
        });
    });

    document.getElementById('remove').addEventListener('click', function () {
        pagesLS.remove(function (data) {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            document.getElementById('title-html').innerHTML = '';

            if (data.error) {
                document.getElementById('content-html').innerHTML = data.error.message;
            } else {
                document.getElementById('content-html').innerHTML = 'Endpoint does not exist';
            }
        });
    });

    document.getElementById('update').addEventListener('click', function () {
        pagesLS.get(function (data) {
            if (data.error) {
                var pagesCollection = {};

                pagesCollection.title = document.getElementById('title').value;
                pagesCollection.content = document.getElementById('content').value;

                pagesLS.set(pagesCollection, function (data) {
                    if (data.error) {
                        console.log(data.error.message);
                    } else {
                        document.getElementById('title-html').innerHTML = data.title;
                        document.getElementById('content-html').innerHTML = data.content;
                    }
                });
            } else {
                data.title = document.getElementById('title').value;
                data.content = document.getElementById('content').value;

                pagesLS.update(data, true);

                document.getElementById('title-html').innerHTML = data.title;
                document.getElementById('content-html').innerHTML = data.content;
            }
        });
    });

</script>

</body>
</html>